
{% extends 'base.html' %}


{% block head %}
 <link rel="stylesheet" type="text/css" href="/static/calc_style.css">

<script type="text/javascript" src= "/static/scriptCalc.js"> </script>
<script src="https://code.jquery.com/jquery.js"></script>
<script src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
<!-- <link rel="stylesheet" typle="text/css" href="/static/style.css"> -->
{% endblock %}


{% block content %}




<h3> Beautiful Display of Art on Wall Mapping! </h3>

	<div class="user_view">
		<p><table>
			<tr>
			  <th>Art Name</th>
			  <th>Origin X Corner </th>		
			  <th>Origin X Corner </th>
			  <th>Changed X Corner </th>		
			  <th>Changed X Corner </th>
			</tr>
			{% for item in art %}
			 <tr> 
				<td class="user_view_output" id="{{ item.art_name }}"> 
					{{ item.art_name }} </td>
				<td id ='{{item.art_name}}_OX'> _</td>
				<td id ='{{item.art_name}}_OY'> _</td>  
				<td id ='{{item.art_name}}_X'> _</td>
				<td id ='{{item.art_name}}_Y'> _</td>  
			  </tr>
			{% endfor %} 
		</table>
	</div>

	<div class="wall"><div>




	<script>
		var wall = ({{wall|tojson}})
		var art = ({{art|tojson}})
		var totArtWidth = 0;
		var blankWall;
		var consistantMargins;
		var midMargin;
		var endMargin;
		var p0;
		var p;
		var xAxis;
		var offset;


		function restoreArtFloats(art){
			for(var i=0; i<art.length; i++){
				art[i].art_width = art[i].art_width / 1000;
				art[i].art_height =art[i].art_height / 1000
				art[i].device_distance = art[i].device_distance / 1000;
			}
		}
		
		restoreArtFloats(art)


		wall.wall_width = wall.wall_width / 1000;
		wall.wall_height = wall.wall_height / 1000;
		wall.center_line = wall.center_line / 1000;
		wall.offset_percent = wall.offset_percent / 1000;




		// FIND TOTAL WIDTH OF ART
		function allArtsWidths(obj){ 
			for ( var w = 0; w < obj.length; w++ ){
			    totArtWidth += obj[w].art_width; }}; 

		

		// MIDDLE AND END MARGINS
		function Margins() {
			blankWall = wall.wall_width - totArtWidth; 
			consistantMargins = (blankWall / (art.length + 1));
			offset = consistantMargins * wall.offset_percent;
			midMargin = consistantMargins - offset; 
			if (art.length === 2) {
				endMargin = consistantMargins + offset / 2;
			} else { 
				endMargin = consistantMargins + offset;
		}};


		//ADD THIS TO FUNCTION ABOVE??
		if (art.length === 1){
			endMargin = consistantMargins
		}


		// UPPER EDGE LONGITUDE OF ALL ARTS
		function upperX(obj) {
			for(var i = 0; i < obj.length; i ++){
			    var each = obj[i].art_height / 2 + wall.center_line;
			    obj[i].upperEdge = each
		}};



		//LEFT CORNER COORDINATES FOR MAPPING
		function leftCornerCords(obj){
			p0 = endMargin;
			p = midMargin;
			xAxis = [p0]
			for(i=1; i<obj.length; i++){
			    xAxis[i] = xAxis[i-1] + obj[i-1].art_width + p
			}
			for(var i = 0; i < xAxis.length; i++){
			    obj[i].leftCorner = {X : 0};
			    obj[i].leftCorner.X = xAxis[i];
		}};



		//"TAC POINT" FOR USER INFO
		function findTacPoint(obj){ 
			for(var i = 0; i < obj.length; i++){
			    obj[i].leftCorner.Y = obj[i].upperEdge;
			    obj[i].leftCorner.Y = Math.round(obj[i].leftCorner.Y * 100) / 100;
			    obj[i].leftCorner.X = Math.round(obj[i].leftCorner.X * 100) / 100;

			    if (obj[i].device_code === 'none'){
			        obj[i].userDataCord = {X : obj[i].leftCorner.X, 
			                                Y : obj[i].leftCorner.Y};
			    } else {
			        obj[i].userDataCord = {X : (obj[i].leftCorner.X + 
			        					  	obj[i].art_width/2),
			                              Y : (obj[i].leftCorner.Y - 
			                              	obj[i].device_distance)};
		}}};


		function dynamicRectangles(){ 	
			width = window.innerWidth / 2;
			scale = width * wall.wall_height / 2;
			width = window.innerWidth;
			scale = width * wall.wall_height
			var svgContainer = d3.select(".wall")
										.append("svg")
		                                .attr("width", wall.wall_width)
		                                .attr("height", wall.wall_height)
		                                .style("border", "1px dashed black")
		                                ;

		        var drag = d3.behavior.drag()
		            .on("drag", dragMove)
		         


		        var rect = svgContainer.selectAll(".draggableRectangle").data(art).enter()
		        		.append('rect')
		        		.attr('class', 'draggableRectangle')
		        		.attr('name', function(d) { return d.art_name; })
		                 .attr('x', function(d) { return d.leftCorner.X; })
		                 .attr('y', function(d) {return wall.wall_height - d.leftCorner.Y; })
		                 .attr('Ox', function(d) { return d.leftCorner.X; })
		                 .attr('Oy', function(d) {return wall.wall_height - d.leftCorner.Y; })
		                 .attr('width', function(d) { return d.art_width; })
		                 .attr('height', function(d) { return d.art_height; })
		                 .style("fill", "red")
		                 .call(drag);
		        var images = rect.selectAll("")


		        
      			
		        function dragMove(d) {
			         d3.select(this)
			             .attr("x", function () {return d3.event.x})
			             .attr("y", function () {return d3.event.y});
			         var X = document.getElementById(d.art_name+"_X");
			             X.innerHTML = Math.round(d3.event.x);
			         var Y = document.getElementById(d.art_name+"_Y");
			             Y.innerHTML = Math.round(wall.wall_height -d3.event.y);
			         
		        	var X = document.getElementById(d.art_name+"_OX");
			            X.innerHTML = d.leftCorner.X
			        var Y = document.getElementById(d.art_name+"_OY");
			            Y.innerHTML = wall.wall_height - d.leftCorner.Y

	                 var name = document.getElementById(d.art_name);
	         	    	 name.innerHTML = d.art_name;
		         }


		}


		allArtsWidths(art);
		Margins();
		upperX(art);
		leftCornerCords(art)
		findTacPoint(art)
		dynamicRectangles()
		 

</script>





{% endblock %}
